#!/bin/bash

set -euo pipefail

print_help() {
    printf "Usage: %s <build | deploy | start | restart | stop>\n" "$(basename "${0}")"
}

if [[ "${#}" -gt 1 ]]; then
    printf "Only one command is accepted\n" >&2
    print_help
    exit 1
elif [[ "${#}" -eq 0 ]]; then
    print_help
    exit 0
fi

case "${1:-}" in
    "build")
        docker build --progress plain -t cs16-server-net .
        ;;
    "deploy")
        docker run --init -d -p 27015:27015/udp -p 27015:27015 --name cs16-server-net cs16-server-net
        ;;
    "start")
        docker start cs16-server-net
        ;;
    "restart")
        docker restart cs16-server-net
        ;;
    "stop")
        docker stop cs16-server-net
        ;;
    *)
        printf "Invalid command: %s\n" "${1}" >&2
        print_help
        exit 1
        ;;
esac
